#!/usr/bin/env ruby

require 'mrm'
require 'optparse'
require 'ostruct'

options = OpenStruct.new
client = MRM::Client.new

OptionParser.new do |opts|
  opts.banner = 'Usage: mrm [options] <command>'

  opts.on('-v', '--version', 'Prints gem version') do |v|
    options.v = true
  end

  opts.on('-h', '--help', 'Display this help') do
    puts opts.to_s.split("\n")
    puts "\nCommands:"
    printf("%-3s %-32s %-15s", '', 'list', "Shows the list of repositories\n")
    printf("%-3s %-5s %-26s %-15s", '', 'list', '*repo_name*', "Lists tags of the specific repository\n")
    abort
  end
end.parse!

if options.v
  puts MRM::Version.to_s
  abort
end

case ARGV[0]
when 'check'
  client.version_check
when 'list'
  if ARGV[1].nil?
    client.list_repositories
  else
    client.list_tags(ARGV[1])
  end
else
  puts 'Unknown command supplied'
end
